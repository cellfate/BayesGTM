# BayesGTM scripts

Bayesian inference of gene transcriptional burst kinetics of generalized telegraph model (GTM) from single cell snapshots data, such as smFISH and scRNA-seq.

BayesGTM is a  inference framework to estimate burst kinetic parameters of gene expression from static single cell snapshots data. Given an observed single cell snapshot data, BayesGTM uses a sequential Monte Carlo approximate Bayesian computation (SMC-ABC) approach to estimate the posterior probability density distribution of the GTM parameters and  underlying burst kinetic parameters.

## System Requirements for GTM Scripts

test_demo.m, test_MEFs.m, simulGTM, statisData.m, statisGTM.m, figureResult.m, ABCSMCSampler.m, ABCRejectionSampler.m are all MATLAB scripts with versions.

```matlab
MATLAB Version: 9.10.0.1649659 (R2021a) Update 1
Operating System: Microsoft Windows 10 Professional Version 10.0 (Build 19044)
Java Version: Java 1.8.0_202-b08 with Oracle Corporation Java HotSpot(TM) 64-Bit Server VM mixed mode
```

## Directories

**test_demo.m**

*test_demo.m* is the master program for estimating the burst kinetic parameters from scRNA-seq data simulated by GTM for a given parameter. You can set any parameters ($k_{on}, r_{on}, k_{off}, r_{off}, r_{syn}$) to test the accuracy of GTM inference algorithm.

output : *test_demo.m* outputs distribution fit plot, posterior distribution plot of $r_{syn}$, two-dimensional posterior distribution plot of mean dwell time $\tau_{on}, \tau_{off}$ and burst kinetic BF, BS. All the data generated during the inference process is stored by a mat file in `results/example` directory.

**test_MEFs.m**

*test_MEFs.m* is the master program for mouse embryonic fibroblasts (MEFs) scRNA-seq data. The program can be accelerated using parallel programs. The results for each individual gene are stored in `results/results_MEF` directory and csv.file of all results can be collected by *collectResult.m*. For example:

| Burst Frequency | Burst Size  |
| :-------------: | :---------: |
|   BF of gene1   | BS of gene1 |
|   BF of gene2   | BS of gene2 |
|       ...       |     ...     |

**simulGTM.m**

simulGTM.m is a function that simulates scRNA-seq data according to the input parameters ($k_{on}, r_{on}, k_{off}, r_{off}, r_{syn}$) under the GTM.

**statisGTM.m**

statisGTM.m is a function that calculates summary statistics for a given parameter according to the relationship between the statistics and the binomial moment of the GTM.

**statisData.m**

statisData.m is a function that computes some summary statistics of scRNA-seq data, including mean, noise strength, fano factor, skewness, kurtosis, binomial coefficient.

**ABCSMCSampler.m**

ABCSMCSampler.m is a function that programs the Sequential Monte Carlo Sampler of approximate Bayesian computation.

**ABCRejectionSampler.m**

ABCRejectionSampler.m is a function that programs the Rejection Sampler for approximate Bayesian computation.

**figureResult.m**

figureResult.m visualizes the inference results of BayesGTM algorithm. It compares the true value and the estimated value of the transcriptional rate $r_{syn}$, the mean dwell time of ON and OFF state $\tau_{on}, \tau_{off}$, the burst frequency and the burst size.

**figureGenome.R**

figureResult.R visualizes  the results of a genome-wide comparison between classical telegram models (CTM) and GTM, with Dependencies: ggplot2 (3.3.6), ggpubr (0.4.0).

**Directory**

The `GTM vs CTM` directory contains scripts that can use CTM to estimate the data generated by GTM. test.m is the master program. GTMvsCTM_1.mat and GTMvsCTM_2.mat are results of two example.

The `data` directory contains the scRNA-seq data from mouse embryonic fibroblasts described in Larsson  et al. 2019, Nature. MEF_QC_all is quality controlled and genename.txt is the gene name corresponding to each row.

The `results` directory contains results of two examples from *demo.m* and genome-wide MEFs from test_MEFs.m. 

The `misc` directory contains some other functions.

## Example

```matlab
# open the test_demo.m
load('results\example\3_0.5_2_0.5_20.mat')
[result,~] = ABCSMCSampler(N,prior,f,rho,epsilon,T,proposal,proposal_pdf,1);
figureResult(data,result(:,end),param_true)
save(sprintf('results/example/%d_%.1f_%d_%.1f_%d_%d.mat',param_true.kon,param_true.ron,param_true.koff,param_true.roff,param_true.mu))
```
